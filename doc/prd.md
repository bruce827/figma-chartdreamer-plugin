# ChartDreamer 产品需求文档 (PRD)

| 版本 | 日期       | 作者   | 状态     | 变更内容       |
| ---- | ---------- | ------ | -------- | -------------- |
| v1.1 | 2025-08-14 | Gemini | 设计中   | 增加 v1.1 AI功能 |
| v1.0 | 2025-08-14 | Gemini | 已完成   | 初始版本创建   |

---

## 1. 项目概述

### 1.1 项目背景

在现代设计流程中，数据可视化扮演着越来越重要的角色。然而，设计师和产品经理常常需要在多个工具之间切换（如从Excel到Figma），导致效率低下、数据更新困难。ChartDreamer 旨在解决这一痛点，让用户在 Figma 内部即可完成从数据到专业图表的无缝转换。

### 1.2 产品目标

- **核心目标**: 打造一款强大、易用、高度可定制的 Figma 数据可视化插件。
- **近期目标 (v1.0)**: 实现桑基图 (Sankey Diagram) 生成器的核心功能，并提供良好的用户体验。
- **长期愿景**: 成为 Figma 生态中最受欢迎的数据可视化解决方案，支持多种主流图表类型，并集成外部数据源。

### 1.3 用户画像

- **UI/UX 设计师**: 需要快速创建数据图表以用于产品设计稿、演示报告和设计系统。
- **产品经理**: 希望将数据分析结果（如用户流程）快速转化为可视化图表，用于产品决策和沟通。
- **数据分析师**: 需要将分析结果以美观、专业的方式呈现给设计和产品团队。

---

## 2. 功能需求 (v1.0)

### 2.1 核心功能 - 桑基图生成

| 功能模块     | 需求描述                                                                                                                              | 优先级 | 状态   |
| :----------- | :------------------------------------------------------------------------------------------------------------------------------------ | :--- | :----- |
| **数据输入** | - 支持 JSON、CSV、TSV 三种格式的数据粘贴输入。<br>- 提供格式示例和清晰的输入引导。<br>- 实时数据验证，提供友好的错误提示和修复建议。 | P0   | ✅ 已完成 |
| **图表配置** | - 支持图表尺寸、节点宽度、边距等基础布局配置。<br>- 支持预设主题（浅色/深色）和完全自定义的颜色配置。<br>- 支持多种样式配置：节点形状、链接样式、阴影、渐变等。 | P0   | ✅ 已完成 |
| **图表渲染** | - 使用 D3.js 引擎计算桑基图布局。<br>- 将计算结果渲染为 Figma 中的矢量图层（矩形、矢量路径、文本）。<br>- 所有图层自动编组，并放置在新建的 Frame 中。 | P0   | ✅ 已完成 |

### 2.2 辅助功能 - 提升用户体验

| 功能模块         | 需求描述                                                                                                      | 优先级 | 状态         |
| :--------------- | :------------------------------------------------------------------------------------------------------------ | :--- | :----------- |
| **历史记录**     | - 自动保存最近10次生成记录。<br>- 支持加载、删除、清空历史记录。<br>- 提供时间戳和配置预览。                   | P1   | ✅ 已完成     |
| **设置持久化**   | - 自动保存用户的所有配置项，下次打开插件时恢复。<br>- 记住用户最后使用的数据格式。                                 | P1   | ✅ 已完成     |
| **性能优化**     | - 对大数据量进行智能检测，并提供性能警告。<br>- 对高频操作（如输入、颜色选择）进行防抖处理。<br>- 使用组件缓存技术减少不必要的渲染。 | P1   | ✅ 已完成     |
| **模板库**       | - 提供至少5个预设的常用图表模板，方便用户快速上手。                                                           | P2   | 待开发       |
| **撤销/重做**    | - 支持在插件内部进行撤销/重做操作，提升容错率。                                                               | P2   | 待开发       |
| **快捷键**       | - 为常用操作（如生成、打开历史记录）定义快捷键。                                                                | P3   | 待开发       |

---

### 2.3 功能需求 (v1.1) - AI赋能与体验增强

| 功能模块 | 需求描述 | 优先级 | 状态 |
| :--- | :--- | :--- | :--- |
| **AI数据生成** | - **核心**：用户可以通过输入描述性文字（如“创建一个从市场部到产品A和产品B的用户流量图”），调用AI模型自动生成图表所需的数据。<br>- 在数据输入区增加 “AI生成” 模式。<br>- AI生成的数据将自动填充到标准数据输入框中，供用户预览、修改。 | P0 | 待开发 |
| **AI配置面板** | - 在插件中提供一个独立的设置区域。<br>- 用户可以在此配置AI服务的API Key。<br>- 未来可扩展为模型选择（如 GPT-4, Claude 3 等）。 | P0 | 待开发 |
| **Prompt优化** | - 在AI输入框中提供3-5个高质量的Prompt示例，引导用户更好地使用AI功能。<br>- 当AI生成失败或效果不佳时，提供优化Prompt的建议。 | P1 | 待开发 |
| **UI/UX优化** | - 引入 `figma-plugin-ds-react` 或 `shadcn/ui` 美化核心组件，使其风格更贴近Figma原生。<br>- 优化历史记录面板的视觉展示。 | P1 | 待开发 |
| **模板库** | - 提供5个常用的预设图表模板（如用户流失分析、渠道来源分析等），点击即可加载示例数据和最佳配置。 | P2 | 待开发 |
| **撤销/重做** | - 支持在插件内部进行撤销/重做操作，提升容错率。 | P2 | 待开发 |

---

## 3. 非功能性需求

- **性能**: 在处理100个节点以内的数据时，应保证流畅的体验；处理500个节点以上时，应有明确的性能提示。
- **可用性**: 界面简洁直观，无需阅读文档即可上手。关键操作应有清晰的引导和反馈。
- **兼容性**: 兼容最新版本的 Figma 桌面客户端 (macOS / Windows)。
- **安全性**: 所有用户数据仅存储在本地 `figma.clientStorage` 中，不上传至任何服务器。

---

## 4. 未来版本规划 (Roadmap)

### 4.1 v1.0 - MVP与核心功能

- **已完成**: 桑基图生成器的核心功能，包括数据输入、样式配置、历史记录和性能优化。

### 4.2 v1.1 - AI赋能与体验增强

- **核心**: 实现通过自然语言生成图表数据，大幅降低使用门槛。
- **增强**: 优化UI/UX，并提供模板库等实用功能，提升整体产品体验。

### 4.3 v2.0 - 连接外部世界

- **外部数据源**: 实现与 Google Sheets、Airtable 等外部数据源的API对接，实现数据自动同步。
- **团队协作**: 支持将图表配置保存为团队模板，方便共享和复用。

### 4.4 探索方向

- **3D图表**: 在独立的特性分支上探索使用 `Three.js` 渲染3D图表的可能性。
- **交互式图表**: 支持生成带有悬浮提示、点击交互的图表原型。

---

## 5. 验收标准

- **功能完整性**: PRD 中标记为“已完成”的功能均可正常使用。
- **稳定性**: 在常见使用场景下，插件无明显卡顿或崩溃现象。
- **用户体验**: 用户可以独立完成从数据输入到图表生成的全过程，且体验流畅。

---

## 6. 附录

- **相关文档**: `doc/roadmap.md`, `doc/startUp.md`
- **设计稿**: (待补充)
- **技术选型**: `Preact` + `TypeScript` + `esbuild` (基于 `create-figma-plugin`)

